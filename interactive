patrick@patrick-Alienware-Aurora-R15:~$ ssh patrick3@206.12.124.6
Last login: Thu Jun  8 10:18:42 2023 from opennet-33-72.uhnres.utoronto.ca
================================================================================
Welcome to Cedar! / Bienvenue sur Cedar!

For information see: https://docs.alliancecan.ca/wiki/Cedar
Email support@tech.alliancecan.ca for assistance and/or to report problems.

Pour plus d’information lisez : https://docs.alliancecan.ca/wiki/Cedar
Écrivez à support@tech.alliancecan.ca pour obtenir de l’aide ou rapporter un
problème.
================================================================================

UPCOMING /scratch REBUILD

Cedar will be unavailable from June 23rd to June 27th. During this maintenance
window, the /scratch filesystem will be completely erased and rebuilt. If you
do not copy or back up the files you need to keep before June 23rd, they will
be lost and impossible to recover. Note that copying files can take a long time.
Please start as soon as possible.

Note that using the “touch” command to avoid periodic purging of /scratch is
considered abuse. It will not prevent this planned purge since the whole filesystem
will be erased.

RECONSTRUCTION PROCHAINE DU /scratch

Cedar sera indisponible du 23 au 27 juin. Pendant cette période, le système de
fichiers /scratch sera reconstruit pour en renforcer la stabilité. Les
fichiers que vous voulez conserver doivent être sauvegardés ou copiés ailleurs
avant le 23 juin, faute de quoi il sera impossible de les récupérer. Puisque
les opérations de copie peuvent nécessiter beaucoup de temps, nous vous
recommandons d’agir au plus tôt.

Notez que l'utilisation de la commande touch pour éviter la purge périodique de
l’espace /scratch est considérée comme étant une pratique abusive et elle
n'empêchera pas la suppression de tout le contenu.

[patrick3@cedar5 ~]$ cd scratch 
[patrick3@cedar5 scratch]$ salloc --account=def-hansenhe --time=0:40:0 --ntasks=1 --cpus-per-task=10 --mem=180G --nodes 1 --gres=gpu:v100l:4
salloc: Pending job allocation 4035662
salloc: job 4035662 queued and waiting for resources
salloc: job 4035662 has been allocated resources
salloc: Granted job allocation 4035662
[patrick3@cdr2630 scratch]$ nvidia-smiu
/bin/bash: nvidia-smiu: command not found
[patrick3@cdr2630 scratch]$ watch nvidia-smi
[patrick3@cdr2630 scratch]$ nvidia-smi
Thu Jun  8 10:59:50 2023       
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 520.61.05    Driver Version: 520.61.05    CUDA Version: 11.8     |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|                               |                      |               MIG M. |
|===============================+======================+======================|
|   0  Tesla V100-SXM2...  On   | 00000000:18:00.0 Off |                    0 |
| N/A   37C    P0    45W / 300W |      0MiB / 32768MiB |      0%      Default |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+
|   1  Tesla V100-SXM2...  On   | 00000000:3B:00.0 Off |                    0 |
| N/A   36C    P0    41W / 300W |      0MiB / 32768MiB |      0%      Default |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+
|   2  Tesla V100-SXM2...  On   | 00000000:86:00.0 Off |                    0 |
| N/A   35C    P0    43W / 300W |      0MiB / 32768MiB |      0%      Default |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+
|   3  Tesla V100-SXM2...  On   | 00000000:AF:00.0 Off |                    0 |
| N/A   37C    P0    43W / 300W |      0MiB / 32768MiB |      0%      Default |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+
                                                                               
+-----------------------------------------------------------------------------+
| Processes:                                                                  |
|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |
|        ID   ID                                                   Usage      |
|=============================================================================|
|  No running processes found                                                 |
+-----------------------------------------------------------------------------+
[patrick3@cdr2630 scratch]$ module load python/3.8
[patrick3@cdr2630 scratch]$ virtualenv --no-download $SLURM_TMPDIR/ENV
source $SLURM_TMPDIR/ENV/bin/activatecreated virtual environment CPython3.8.10.final.0-64 in 6640ms
  creator CPython3Posix(dest=/localscratch/patrick3.4035662.0/ENV, clear=False, global=False)
  seeder FromAppData(download=False, pip=latest, setuptools=latest, wheel=latest, via=copy, app_data_dir=/home/patrick3/.local/share/virtualenv/seed-app-data/v1.0.1)
  activators BashActivator,CShellActivator,FishActivator,PowerShellActivator,PythonActivator,XonshActivator
[patrick3@cdr2630 scratch]$ source $SLURM_TMPDIR/ENV/bin/activate
(ENV) [patrick3@cdr2630 scratch]$ pip3 install --no-index -r requirements_pep.txt
Ignoring pip: markers 'python_version < "3"' don't match your environment
Looking in links: /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/avx2, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/generic, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/accelerate-0.18.0+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/certifi-2022.12.7+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/charset_normalizer-3.1.0+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/click-8.1.3+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/generic/contourpy-1.0.7+computecanada-cp38-cp38-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/cycler-0.11.0+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/filelock-3.12.0+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/fonttools-4.39.3+computecanada-cp38-cp38-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/fsspec-2023.5.0+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/huggingface_hub-0.14.1+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/idna-3.4+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/importlib_resources-5.12.0+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/joblib-1.2.0+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/avx2/kiwisolver-1.4.4+computecanada-cp38-cp38-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/markdown_it_py-2.2.0+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/avx2/matplotlib-3.7.0+computecanada-cp38-cp38-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/mdurl-0.1.2+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/nltk-3.8.1+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/generic/numpy-1.24.2+computecanada-cp38-cp38-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/packaging-23.1+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/avx2/pandas-1.5.3+computecanada-cp38-cp38-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/avx2/Pillow-9.5.0+computecanada-cp38-cp38-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/avx2/Pillow_SIMD-9.0.0.post1+computecanada-cp38-cp38-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/psutil-5.9.4+computecanada-cp38-abi3-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/Pygments-2.15.1+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/pynvml-11.4.1+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/pyparsing-3.0.9+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/python_dateutil-2.8.2+computecanada-py2.py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/pytz-2023.3+computecanada-py2.py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/avx2/PyYAML-6.0+computecanada-cp38-cp38-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/regex-2022.10.31+computecanada-cp38-cp38-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/requests-2.28.2+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/rich-13.3.5+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/generic/scikit_learn-1.2.1+computecanada-cp38-cp38-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/generic/scipy-1.10.1+computecanada-cp38-cp38-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/sentence_transformers-2.2.2+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/generic/sentencepiece-0.1.97+computecanada-cp38-cp38-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/six-1.16.0+computecanada-py2.py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/sklearn-0.0+computecanada-py2.py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/threadpoolctl-3.1.0+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/generic/tokenizers-0.13.2+computecanada-cp38-cp38-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/avx2/torch-1.13.1+computecanada-cp38-cp38-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/avx2/torchaudio-0.13.1+computecanada-cp38-cp38-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/torchtext-0.6.0+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/generic/torchvision-0.14.1+computecanada-cp38-cp38-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/tqdm-4.65.0+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/transformers-4.29.2+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/typing_extensions-4.5.0+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/urllib3-1.26.15+computecanada-py2.py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/zipp-3.15.0+computecanada-py3-none-any.whl
Installing collected packages: psutil, typing-extensions, torch, PyYAML, packaging, numpy, accelerate, certifi, charset-normalizer, click, contourpy, cycler, filelock, fonttools, fsspec, tqdm, urllib3, idna, requests, huggingface-hub, zipp, importlib-resources, joblib, kiwisolver, mdurl, markdown-it-py, pyparsing, Pillow, six, python-dateutil, matplotlib, regex, nltk, pytz, pandas, Pillow-SIMD, Pygments, pynvml, rich, scipy, threadpoolctl, scikit-learn, torchvision, tokenizers, transformers, sentencepiece, sentence-transformers, sklearn, torchaudio, torchtext
Successfully installed Pillow-9.5.0+computecanada Pillow-SIMD-9.0.0.post1+computecanada PyYAML-6.0+computecanada Pygments-2.15.1+computecanada accelerate-0.18.0+computecanada certifi-2022.12.7+computecanada charset-normalizer-3.1.0+computecanada click-8.1.3+computecanada contourpy-1.0.7+computecanada cycler-0.11.0+computecanada filelock-3.12.0+computecanada fonttools-4.39.3+computecanada fsspec-2023.5.0+computecanada huggingface-hub-0.14.1+computecanada idna-3.4+computecanada importlib-resources-5.12.0+computecanada joblib-1.2.0+computecanada kiwisolver-1.4.4+computecanada markdown-it-py-2.2.0+computecanada matplotlib-3.7.0+computecanada mdurl-0.1.2+computecanada nltk-3.8.1+computecanada numpy-1.24.2+computecanada packaging-23.1+computecanada pandas-1.5.3+computecanada psutil-5.9.4+computecanada pynvml-11.4.1+computecanada pyparsing-3.0.9+computecanada python-dateutil-2.8.2+computecanada pytz-2023.3+computecanada regex-2022.10.31+computecanada requests-2.28.2+computecanada rich-13.3.5+computecanada scikit-learn-1.2.1+computecanada scipy-1.10.1+computecanada sentence-transformers-2.2.2+computecanada sentencepiece-0.1.97+computecanada six-1.16.0+computecanada sklearn-0.0+computecanada threadpoolctl-3.1.0+computecanada tokenizers-0.13.2+computecanada torch-1.13.1+computecanada torchaudio-0.13.1+computecanada torchtext-0.6.0+computecanada torchvision-0.14.1+computecanada tqdm-4.65.0+computecanada transformers-4.29.2+computecanada typing-extensions-4.5.0+computecanada urllib3-1.26.15+computecanada zipp-3.15.0+computecanada
(ENV) [patrick3@cdr2630 scratch]$ export NCCL_BLOCKING_WAIT=1
(ENV) [patrick3@cdr2630 scratch]$ export MASTER_ADDR=$(hostname)
(ENV) [patrick3@cdr2630 scratch]$ echo "r$SLURM_NODEID master: $MASTER_ADDR"
r0 master: cdr2630.int.cedar.computecanada.ca
(ENV) [patrick3@cdr2630 scratch]$ echo "r$SLURM_NODEID Launching python script"
r0 Launching python script
(ENV) [patrick3@cdr2630 scratch]$ srun python3 LLM/train_ddp.py --init_method tcp://$MASTER_ADDR:3456 --world_size $SLURM_NTASKS 
INFO:torch.distributed.distributed_c10d:Added key: store_based_barrier_key:1 to store for rank: 0
INFO:torch.distributed.distributed_c10d:Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
torch.distributed process group is initialized, but parallel_mode != ParallelMode.DISTRIBUTED. In order to use Torch DDP, launch your script with `python -m torch.distributed.launch
Starting...
From Rank: 0, ==> Initializing Process Group...
process group ready!
From Rank: 0, ==> Making model..
From Rank: 0, ==> Preparing data..
/localscratch/patrick3.4035662.0/ENV/lib/python3.8/site-packages/transformers/optimization.py:407: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
  0%|          | 0/234000 [00:00<?, ?it/s]You're using a BertTokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.
/localscratch/patrick3.4035662.0/ENV/lib/python3.8/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
 46%|████▌     | 108207/234000 [14:54<134:45:56,  3.87s/it]


